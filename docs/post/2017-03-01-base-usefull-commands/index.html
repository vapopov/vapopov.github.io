<!doctype html>
<html>
<head>
    <base href="/">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="author" content="John Doe">

<meta name="description" content="">

<title>Base usefull commands</title>
<meta name="generator" content="Hugo 0.58.2" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/pojoaque.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
<link  href="/css/theme.min.css" rel="stylesheet" type="text/css">

</head>
<body>
<div class="page-container container-fluid">
<div class="col-md-3 menu">
    <nav class="col-md-3">
    
    <h3 class="home-link"><a href="">Root</a></h3>
    <div id="last-posts" class="open">
        <h3 data-open="last-posts">Vadym Popov - Most recent posts</h3>
        <ul>
            
            <li><a href="/post/2017-08-12-git-gpg-verification/">Git Gpg Verification</a></li>
            
            <li><a href="/post/2017-08-12-query-planner/">Query Planner</a></li>
            
            <li><a href="/post/2017-03-01-base-usefull-commands/">Base usefull commands</a></li>
            
            <li><a href="/post/2017-06-01-nginx-optimization/">Server optimisation for nginx</a></li>
            
            <li><a href="/post/welcome/">Welcome</a></li>
            
        </ul>
    </div>
    

    
    <div id="tags" class="open">
        <h3 data-open="tags">Tags</h3>
        <ul class="tags">
            
            <li><a href="/tags/bash">bash</a></li>
            
            <li><a href="/tags/git">git</a></li>
            
            <li><a href="/tags/gpg">gpg</a></li>
            
            <li><a href="/tags/linux">linux</a></li>
            
            <li><a href="/tags/nginx">nginx</a></li>
            
            <li><a href="/tags/pg">pg</a></li>
            
            <li><a href="/tags/redis">redis</a></li>
            
            <li><a href="/tags/rsync">rsync</a></li>
            
            <li><a href="/tags/sql">sql</a></li>
            
            <li><a href="/tags/ssh">ssh</a></li>
            
            <li><a href="/tags/sysctl">sysctl</a></li>
            
            <li><a href="/tags/test">test</a></li>
            
            <li><a href="/tags/welcome">welcome</a></li>
            
        </ul>
    </div>
    

    
</nav>

</div>
<div class="col-md-9 content">

<h1>Base usefull commands</h1>
<h4>Published 07-21-2017 07:35:01</h4>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="kendo5731"></a>
<script>!function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
    if (!d.getElementById(id)) {
        js = d.createElement(s);
        js.id = id;
        js.src = p + '://platform.twitter.com/widgets.js';
        fjs.parentNode.insertBefore(js, fjs);
    }
}(document, 'script', 'twitter-wjs');</script>

<div class="fb-share-button" data-href="/post/2017-03-01-base-usefull-commands/" data-layout="button"></div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en-US/sdk.js#xfbml=1&version=v2.5";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<article>
    

<h2 id="docker">Docker</h2>

<p>Mount portworx volume to the empty container</p>

<pre><code class="language-bash">docker run -it --rm --volume-driver pxd -v name=hublndstaging:/data alpine sh
</code></pre>

<h2 id="unix-filesystem">Unix Filesystem</h2>

<p>Remove files that is older than 7 days with specified file mask</p>

<pre><code class="language-bash">find /data/ -mtime +7 -name &quot;*.gz&quot; -exec rm {} \;
</code></pre>

<h2 id="git-base-workflow">Git base workflow</h2>

<p>Push updatest from one remote repository to another, very helpful in case of work with github forked repositories</p>

<pre><code class="language-bash">git push vp origin/master:refs/heads/master
Counting objects: 9, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (9/9), done.
Writing objects: 100% (9/9), 2.88 KiB | 1.44 MiB/s, done.
Total 9 (delta 6), reused 0 (delta 0)
remote: Resolving deltas: 100% (6/6), completed with 4 local objects.
To github.com:vapopov/lnd.git
   92eebff6..9b729654  origin/master -&gt; master
</code></pre>

<p>If you need to update all branches in remote repository</p>

<pre><code class="language-bash">git push rorg refs/remotes/origin/*:refs/heads/*
Counting objects: 293, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (67/67), done.
Writing objects: 100% (176/176), 48.32 KiB, done.
Total 176 (delta 105), reused 168 (delta 97)
remote: Resolving deltas:  11% (12/105)
To MY_REPOSITORY_URL
 * [new branch]      korg/gingerbread-&gt; gingerbread
 * [new branch]      korg/gingerbread-release -&gt; gingerbread-release
 * [new branch]      korg/honeycomb-&gt; honeycomb
 * [new branch]      korg/HEAD -&gt; HEAD
 * [new branch]      korg/honeycomb-mr1-release-&gt; honeycomb-mr1-release
 * [new branch]      korg/master -&gt; master
</code></pre>

<h2 id="redis-multi-actions">Redis multi actions</h2>

<p>Remove values by pattern</p>

<pre><code class="language-bash">redis-cli -h dev-1.example.com EVAL &quot;local keys = redis.call('keys', ARGV[1])
for i=1,#keys,5000 do
  redis.call('del', unpack(keys, i, math.min(i+4999, #keys))) 
end 
return keys&quot; 0 pattern:*
</code></pre>

<p>Check TTL by pattern</p>

<pre><code class="language-bash">redis-cli -h dev-1.example.com EVAL &quot;
local ttls = {}
for i, name in ipairs(redis.call('KEYS', ARGV[1])) do 
  ttls[i] = {redis.call('ttl', name), name}; 
end
return ttls&quot; 0 *pattern*
</code></pre>

<h2 id="ssh-scp">SSH/SCP</h2>

<h3 id="create-backup-from-remote-host-data-docker-volume">Create backup from remote host data docker volume</h3>

<p>Entrypoint should be dropped, because it may contain some execution which could add some data to stdout</p>

<pre><code class="language-bash">ssh user@remote.host &quot;docker-compose -f ~/service/docker-compose.yml run --entrypoint=&quot;&quot; --rm servicename tar -zc /internal/volume&quot; | tar -zx -C ~/where/to/create
</code></pre>

<h3 id="create-and-transfer-archive-directly-to-the-remote-host">Create and transfer archive directly to the remote host</h3>

<pre><code class="language-bash">$ tar -zc ./path | ssh user@remote.host &quot;cat &gt; ~/file.tar.gz&quot;
$ tar -zc ./path | ssh user@remote.host &quot;tar -zx -C /destination&quot;
</code></pre>

<h3 id="transfer-data-with-excluding-files-by-pattern">Transfer data with excluding files by pattern</h3>

<pre><code class="language-bash">rsync -e ssh -azv --exclude 'exclude.py' user@example.com:/var/www/example.com/ /var/www/example.com/
</code></pre>

<h2 id="rsync">Rsync</h2>

<h3 id="sync-files-and-directory-locally">Sync files and directory locally</h3>

<pre><code class="language-bash">$ rsync -zvh backup.tar /tmp/backups/
created directory /tmp/backups
backup.tar
sent 14.71M bytes  received 31 bytes  3.27M bytes/sec
total size is 16.18M  speedup is 1.10
</code></pre>

<p>-z, &ndash;compress          compress file data during the transfer
-v, &ndash;verbose           increase verbosity
-h, &ndash;human-readable    output numbers in a human-readable format</p>

<h3 id="rsync-over-ssh">Rsync Over SSH</h3>

<p>To specify a protocol with rsync you need to give “-e” option with protocol name you want to use. Here in this example, We will be using “ssh” with “-e” option and perform data transfer.</p>

<pre><code class="language-bash">$ rsync -azv -e ssh fahlo@store-staging.fahlo.me:/var/www/store.fahlo.me /var/www/store.fahlo.me
</code></pre>

<p>-a, &ndash;archive           archive mode; equals -rlptgoD (no -H,-A,-X), recursive, links, permissions, group, owner, devices
-z, &ndash;compress          compress file data during the transfer
-v, &ndash;verbose           increase verbosity
-h, &ndash;human-readable    output numbers in a human-readable format</p>

<h3 id="use-of-include-and-exclude-options">Use of –include and –exclude Options</h3>

<p>These two options allows us to include and exclude files by specifying parameters with these option helps us to specify those files or directories which you want to include in your sync and exclude files and folders with you don’t want to be transferred.</p>

<pre><code class="language-bash">$ rsync -avze ssh --include 'R*' --exclude '*' root@192.168.0.101:/var/lib/rpm/ /root/rpm
</code></pre>

<h3 id="use-of-delete-option">Use of –delete Option</h3>

<p>If a file or directory not exist at the source, but already exists at the destination, you might want to delete that existing file/directory at the target while syncing .</p>

<p>We can use ‘–delete‘ option to delete files that are not there in source directory.</p>

<pre><code class="language-bash">$ rsync -avz --delete root@192.168.0.100:/var/lib/rpm/ .
</code></pre>

<h3 id="automatically-delete-source-files-after-successful-transfer-with-dry-run">Automatically Delete source Files after successful Transfer (with &ndash;dry-run)</h3>

<pre><code class="language-bash">$ rsync --dry-run --remove-source-files -zvh backup.tar /tmp/backups/
</code></pre>

</article>



</div>
</div>
<script src="/js/theme.min.js" type="text/javascript"></script>


</body>
</html>

