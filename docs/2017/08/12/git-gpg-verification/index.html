<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Git Gpg Verification  &middot; ┬──┬﻿ ノ( ゜-゜ノ) (╯°□°）╯︵ ┻━┻</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="git, gpg, ssh, ">


<meta property="og:title" content="Git Gpg Verification  &middot; ┬──┬﻿ ノ( ゜-゜ノ) (╯°□°）╯︵ ┻━┻ ">
<meta property="og:site_name" content="┬──┬﻿ ノ( ゜-゜ノ) (╯°□°）╯︵ ┻━┻"/>
<meta property="og:url" content="/2017/08/12/git-gpg-verification/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2017-08-12T19:20:06&#43;02:00" />
<meta property="og:article:modified_time" content="2017-08-12T19:20:06&#43;02:00" />

  
    
<meta property="og:article:tag" content="git">
    
<meta property="og:article:tag" content="gpg">
    
<meta property="og:article:tag" content="ssh">
    
  

  

  



<link rel="canonical" href="/2017/08/12/git-gpg-verification/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
<link rel="icon" href="/favicon.png">
<meta name="generator" content="Hugo 0.25.1" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="/css/bootswatch/cosmo/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">




  <link rel="stylesheet" href="/css/highlight/default.css">


</head>
<body class="map[name:cosmo]" data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="/">
          ┬──┬﻿ ノ( ゜-゜ノ) (╯°□°）╯︵ ┻━┻
          
          
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">

              <a href="/" >
                <i class='fa fa-road'></i>
                About
              </a>
            </li>
            
            <li class="">

              <a href="/post/" >
                
                Blog
              </a>
            </li>
            
            <li class="">

              <a href="/" >
                
                Dashboard
              </a>
            </li>
            
            <li class="">

              <a href="/showcase/" >
                
                Showcase
              </a>
            </li>
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>


<div class="container">
  <div class="row">
    <div class="col-sm-9">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>Git Gpg Verification
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2017-08-12">12 Aug, 2017</time>
</small>


  <small>
  &middot; Read in about 3 min
  &middot; (444 words)
  &middot; 
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Git%20Gpg%20Verification&amp;url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f&amp;title=Git%20Gpg%20Verification" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Git%20Gpg%20Verification&amp;body=Check out this site %2f2017%2f08%2f12%2fgit-gpg-verification%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  </small>

<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="/tags/git" class="label label-primary">git</a>
  
  <a href="/tags/gpg" class="label label-primary">gpg</a>
  
  <a href="/tags/ssh" class="label label-primary">ssh</a>
  


</div>

<br>
</div>

  </div>
</div>

      <div class="content">
  

<h1 id="gpg-and-git-on-macos">GPG and git on MacOS</h1>

<h2 id="setup">Setup</h2>

<ul>
<li>Install <a href="https://gpgtools.org">https://gpgtools.org</a> &ndash; I&rsquo;d suggest to do a <strong>customized install</strong> and deselect <strong>GPGMail</strong>.</li>
<li>Create or import a key &ndash; see below for <a href="https://keybase.io">https://keybase.io</a></li>
<li>Run <code>gpg -K</code> to see all private keys in current machine, use the key ID for the next step (each gpg key has subkeys with different capabilities, its better to choose subkey with sign <code>S</code>)</li>
<li>Configure <code>git</code> to use GPG &ndash; replace the key with the one from <code>gpg --list-secret-keys</code></li>
</ul>

<pre><code>git config --global gpg.program /usr/local/MacGPG2/bin/gpg2
git config --global user.signingkey E5FEE3B2 
git config --global commit.gpgsign true 
</code></pre>

<p>Add this line to <code>~/.gnupg/gpg-agent.conf</code></p>

<pre><code>pinentry-program /usr/local/MacGPG2/libexec/pinentry-mac.app/Contents/MacOS/pinentry-mac
</code></pre>

<p>Add this line to <code>~/.gnupg/gpg.conf</code></p>

<pre><code>no-tty
</code></pre>

<h2 id="keybase-io">Keybase.io</h2>

<p>Import key to GPG on another host</p>

<pre><code>% keybase pgp export
% keybase pgp export -q E5FEE3B2 | gpg --import
% keybase pgp export -q E5FEE3B2 --secret | gpg --allow-secret-key-import --import
</code></pre>

<p>Add public GPG key to GitHub</p>

<pre><code>% open https://github.com/settings/keys
% keybase pgp export -q E5FEE3B2 | pbcopy
</code></pre>

<h2 id="use-gpg-as-ssh-authentication">Use GPG as SSH authentication</h2>

<p>On your Mac edit the file ~/.gnupg/gpg-agent.conf to contain the following:</p>

<pre><code>default-cache-ttl 600
max-cache-ttl 7200
pinentry-program /usr/local/MacGPG2/libexec/pinentry-mac.app/Contents/MacOS/pinentry-mac
enable-ssh-support
write-env-file
</code></pre>

<p>Now edit ~/.profile to contain the following:</p>

<pre><code class="language-bash"># Enable GPG keys for SSH Auth
if [ -f &quot;${HOME}/.gpg-agent-info&quot; ]; then
     . &quot;${HOME}/.gpg-agent-info&quot;
       export GPG_AGENT_INFO
       export SSH_AUTH_SOCK
       export SSH_AGENT_PID
fi
GPG_TTY=$(tty)
export GPG_TTY
</code></pre>

<p><code>GPG_TTY</code> is needed in case if you don&rsquo;t want to use pinentry program from GPGSuite, and must show password dialog in your current active tty</p>

<p>Then we need to export public keys of sub-keys</p>

<pre><code class="language-bash">$ gpg2 -K
/Users/vadym/.gnupg/secring.gpg
-------------------------------
sec   4096R/E5FEE3B2 2017-08-11
uid                  Vadym Popov &lt;me@vpopov.org&gt;
uid                  [jpeg image of size 22756]
ssb   4096R/8A2940A7 2017-08-11
ssb   4096R/0D8DE79D 2017-08-17
ssb   4096R/BB84E418 2017-08-17
</code></pre>

<p>On the moment of writing this article there were some issue with gpg-agent, so I had to export all private keys from old version of gpg that is delivered with GPGSuite to import to latest GnuGPG version.
Export the authentication private key and subkey and import to newest version of GnuGPG:</p>

<pre><code class="language-bash">/usr/local/MacGPG2/bin/gpg2 --armor --export-secret E5FEE3B2 &gt; private.gpg
/usr/local/MacGPG2/bin/gpg2 --armor --export-secret-subkeys --export-options export-reset-subkey-passwd BB84E418 &gt; private_sub.gpg 
gpg --import private.gpg
gpg --import private_sub.gpg
</code></pre>

<p>So now we need add our subkey with auth capability to sshcontrol file and restart gpg-agent</p>

<pre><code class="language-bash">$ gpg -K --with-keygrip
/Users/vadym/.gnupg/pubring.kbx
-------------------------------
sec   rsa4096 2017-08-11 [SC]
      BFA968E385CDB1DA786BCEB7518ABC2FE5FEE3B2
      Keygrip = 2A76E01E169B09A13F85CD2C755CEBDB46E7A86A
uid        [ unbekannt ] Vadym Popov &lt;me@vpopov.org&gt;
uid        [ unbekannt ] [jpeg image of size 22756]
ssb   rsa4096 2017-08-11 [E]
      Keygrip = F820B0F81509FBC09AB35E25E3DD02FB432E2D3D
ssb   rsa4096 2017-08-17 [S]
      Keygrip = 5ABA3AE4B2D9D3653383B231F56DE540CD38436E
ssb   rsa4096 2017-08-17 [A]
      Keygrip = A46472D1A1C6E67DB78BC7986338CD5B6E5DEE4C
</code></pre>

<p>Keygrip of our authentification key <code>A46472D1A1C6E67DB78BC7986338CD5B6E5DEE4C</code> must be added to <code>~/.gnugpg/sshcontrol</code>, after this our key should be visible for <code>ssh-add -l</code></p>

<pre><code>$ ssh-add -l
4096 SHA256:iV18sELhAtjOXZ+UD4bwdTcC/spSSaFpoQrMEr5lDzk (none) (RSA)
</code></pre>

<h2 id="links">Links</h2>

<ul>
<li><a href="https://github.com/pstadler/keybase-gpg-github">https://github.com/pstadler/keybase-gpg-github</a></li>
<li><a href="https://alexcabal.com/creating-the-perfect-gpg-keypair/">https://alexcabal.com/creating-the-perfect-gpg-keypair/</a></li>
<li><a href="http://www.integralist.co.uk/posts/security-basics.html">http://www.integralist.co.uk/posts/security-basics.html</a></li>
<li><a href="https://www.esev.com/blog/post/2015-01-pgp-ssh-key-on-yubikey-neo/">https://www.esev.com/blog/post/2015-01-pgp-ssh-key-on-yubikey-neo/</a></li>
</ul>

</div>


      <footer>
  
<span class="share-box">Share this on:
    <a href="https://www.facebook.com/sharer/sharer.php?u=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-facebook-official "></i></a>

    <a href="https://twitter.com/intent/tweet?text=Git%20Gpg%20Verification&amp;url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-twitter"></i></a>

    <a href="https://plus.google.com/share?url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-google-plus"></i></a>

    <a href="http://www.reddit.com/submit?url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-reddit"></i></a>

    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f2017%2f08%2f12%2fgit-gpg-verification%2f&amp;title=Git%20Gpg%20Verification" onclick="window.open(this.href, 'mywin',
'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-linkedin"></i></a>

    <a href="mailto:?subject=Git%20Gpg%20Verification&amp;body=Check out this site %2f2017%2f08%2f12%2fgit-gpg-verification%2f" data-proofer-ignore=""><i class="fa fa-envelope"></i></a>
  </span>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="/2017/08/12/query-planner/" title="Query Planner">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//vpopov.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

    </div>
    
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div>
  

    <div class="section">
      <header><div class="title"><b>Latest Posts</b></div></header>
      <div class="content">
        <ul>
        
          <li>
          <a href="/2017/08/12/git-gpg-verification/">Git Gpg Verification</a>
          </li>
        
          <li>
          <a href="/2017/08/12/query-planner/">Query Planner</a>
          </li>
        
          <li>
          <a href="/2017/07/21/base-usefull-commands/">Base usefull commands</a>
          </li>
        
          <li>
          <a href="/2017/07/21/server-optimisation-for-nginx/">Server optimisation for nginx</a>
          </li>
        
          <li>
          <a href="/2017/07/20/welcome/">Welcome</a>
          </li>
        
        </ul>
      </div>
    </div>

    
      
      
      <div class="section taxonomies">
        <header><div class="title"><b>tag</b></div></header>

        <div class="content">
          <ul>
            <li><a href="/tags/bash">bash</a></li><li><a href="/tags/git">git</a></li><li><a href="/tags/gpg">gpg</a></li><li><a href="/tags/linux">linux</a></li><li><a href="/tags/nginx">nginx</a></li><li><a href="/tags/pg">pg</a></li><li><a href="/tags/redis">redis</a></li><li><a href="/tags/rsync">rsync</a></li><li><a href="/tags/sql">sql</a></li><li><a href="/tags/ssh">ssh</a></li>
          </ul>
        </div>
      </div>
      
    
      
      
    

</div>

      </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

<a href="/disclaimer/">Disclaimer</a> <i>&middot;</i>

<a href="/terms/">Terms</a> 

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
  code with <i class='fa fa-heart'></i>

</small>
</div>


    
<div class="container copyright">
    <small>
  2017 &copy;

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/angular.min.js"></script>
<script src="/js/popover/angular-storage.min.js"></script>
<script src="/js/highlight.pack.js"></script>
<script src="/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-103006315-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER =  false , 
EXPIRE_COOKIE =  5 , 
SHOW_MODAL_TIMEOUT =  10000 , 
MOUSE_LEAVE =  true , 
MODAL_SIZE = "", 
POST_URL = "https://zapier.com/hooks/...", 
SIGNUP_HEADER = "Join Our Newsletter",
HEADER_IMAGE = " ",
IMG_DESCRIPTION = "Placeholder image for this popover modal optin form",
SIGNUP_TEXT = "Signup today for free and be the first to get notified on new updates.",
INPUT_PLACEHOLDER = "Enter your email",
SUBMIT_BUTTON = "Subscribe",
SUCCESS_MESSAGE = "Thanks for your subscription!",
ERROR_MESSAGE = "Submitting form failed!",
OPTIN =  true ,
COOKIE_NAME = "zion",
CONTENTLANGUAGE = ""; 
</script>

<script src="/js/popover/angular-modal-service.min.js"></script>
<script src="/js/angular-ismobile.min.js"></script>
<script src="/js/popover/popover.min.js"></script>


<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

